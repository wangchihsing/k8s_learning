<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes NodePort å•é¡Œæ’æŸ¥èˆ‡ä¿®å¾©å®Œæ•´åœ–è§£</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
            font-size: 2.5em;
        }
        
        .timeline {
            position: relative;
            margin: 40px 0;
        }
        
        .timeline::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(to bottom, #e74c3c, #f39c12, #27ae60);
            transform: translateX(-50%);
        }
        
        .step {
            margin: 30px 0;
            position: relative;
        }
        
        .step-content {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 45%;
            position: relative;
        }
        
        .step:nth-child(odd) .step-content {
            margin-left: 0;
            border-left: 5px solid #e74c3c;
        }
        
        .step:nth-child(even) .step-content {
            margin-left: 55%;
            border-left: 5px solid #27ae60;
        }
        
        .step-number {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: #3498db;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2em;
            z-index: 10;
        }
        
        .step-number.problem {
            background: #e74c3c;
        }
        
        .step-number.solution {
            background: #27ae60;
        }
        
        .network-diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        
        .network-node {
            background: #3498db;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            margin: 5px;
            text-align: center;
            min-width: 120px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .network-node.blocked {
            background: #e74c3c;
        }
        
        .network-node.working {
            background: #27ae60;
        }
        
        .network-node.vm {
            background: #f39c12;
            color: #2c3e50;
        }
        
        .arrow {
            font-size: 2em;
            color: #e74c3c;
            margin: 0 10px;
        }
        
        .arrow.success {
            color: #27ae60;
        }
        
        .code-block {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
            font-size: 0.9em;
        }
        
        .problem-box {
            background: #ffeaa7;
            border: 2px solid #e17055;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .solution-box {
            background: #d1f2eb;
            border: 2px solid #00b894;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        .diagnostic-results {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .diagnostic-item {
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        
        .diagnostic-item.pass {
            background: #d1f2eb;
            border: 2px solid #00b894;
        }
        
        .diagnostic-item.fail {
            background: #ffeaa7;
            border: 2px solid #e17055;
        }
        
        .final-solution {
            background: linear-gradient(135deg, #00b894, #00a085);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin: 30px 0;
        }
        
        .port-flow {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .port-box {
            background: #3498db;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px;
            font-weight: bold;
        }
        
        .port-box.blocked {
            background: #e74c3c;
        }
        
        .port-box.working {
            background: #27ae60;
        }
        
        .lesson-learned {
            background: #e8f4fd;
            padding: 25px;
            border-radius: 10px;
            border-left: 5px solid #3498db;
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ Kubernetes NodePort å•é¡Œæ’æŸ¥èˆ‡ä¿®å¾©å®Œæ•´æ­·ç¨‹</h1>
        
        <div class="timeline">
            <div class="step">
                <div class="step-number problem">1</div>
                <div class="step-content">
                    <h3>ğŸ¯ åˆå§‹ç›®æ¨™ï¼šè®“ Mac è¨ªå• NodePort</h3>
                    <p><strong>æƒ³è¦é”æˆï¼š</strong>å¾ Mac Safari è¨ªå• <code>http://192.168.200.196:31000</code></p>
                    
                    <div class="network-diagram">
                        <div class="network-node">Mac<br>Safari</div>
                        <div class="arrow">âŒ</div>
                        <div class="network-node vm">è™›æ“¬æ©Ÿ<br>192.168.200.196</div>
                        <div class="arrow">â†’</div>
                        <div class="network-node">Minikube<br>NodePort 31000</div>
                    </div>
                    
                    <div class="problem-box">
                        <strong>å•é¡Œï¼š</strong> ç›´æ¥è¨ªå• <code>http://192.168.200.196:31000</code> å¤±æ•—
                        <div class="code-block">curl: (7) Failed to connect to 192.168.200.196 port 31000: é€£ç·šè¢«æ‹’çµ•</div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">2</div>
                <div class="step-content">
                    <h3>ğŸ” ç¬¬ä¸€æ­¥è¨ºæ–·ï¼šç¢ºèª Kubernetes æœå‹™æ­£å¸¸</h3>
                    
                    <div class="diagnostic-results">
                        <div class="diagnostic-item pass">
                            <h4>âœ… Pod ç‹€æ…‹</h4>
                            <div class="code-block">kubectl get pods
STATUS: Running (5/5)</div>
                        </div>
                        <div class="diagnostic-item pass">
                            <h4>âœ… Service é…ç½®</h4>
                            <div class="code-block">PORT(S): 80:31000/TCP
TYPE: NodePort</div>
                        </div>
                    </div>
                    
                    <p><strong>çµè«–ï¼š</strong>Kubernetes å…§éƒ¨ä¸€åˆ‡æ­£å¸¸ï¼Œå•é¡Œå‡ºåœ¨ç¶²è·¯å±¤é¢</p>
                </div>
            </div>

            <div class="step">
                <div class="step-number">3</div>
                <div class="step-content">
                    <h3>ğŸ§ª ç¬¬äºŒæ­¥è¨ºæ–·ï¼šæ¸¬è©¦ Minikube å…§éƒ¨</h3>
                    
                    <div class="code-block">minikube ssh
curl http://localhost:31000
çµæœï¼šâœ… æˆåŠŸè¿”å› Nginx æ­¡è¿é é¢</div>
                    
                    <div class="solution-box">
                        <strong>ç™¼ç¾ï¼š</strong>NodePort 31000 åœ¨ Minikube å…§éƒ¨å®Œå…¨æ­£å¸¸å·¥ä½œ
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">4</div>
                <div class="step-content">
                    <h3>ğŸ”— ç¬¬ä¸‰æ­¥è¨ºæ–·ï¼šæ¸¬è©¦è™›æ“¬æ©Ÿåˆ° Minikube</h3>
                    
                    <div class="code-block">curl http://192.168.49.2:31000
çµæœï¼šâœ… æˆåŠŸè¿”å› Nginx æ­¡è¿é é¢</div>
                    
                    <div class="solution-box">
                        <strong>ç™¼ç¾ï¼š</strong>è™›æ“¬æ©Ÿå¯ä»¥æ­£å¸¸è¨ªå• Minikube çš„ NodePort
                    </div>
                    
                    <div class="network-diagram">
                        <div class="network-node vm">è™›æ“¬æ©Ÿ</div>
                        <div class="arrow success">âœ…</div>
                        <div class="network-node working">Minikube:31000</div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number problem">5</div>
                <div class="step-content">
                    <h3>âŒ å•é¡Œç¢ºèªï¼šè™›æ“¬æ©Ÿç¶²è·¯éš”é›¢</h3>
                    
                    <div class="diagnostic-results">
                        <div class="diagnostic-item pass">
                            <h4>âœ… Mac â†’ è™›æ“¬æ©Ÿ</h4>
                            <div class="code-block">ping 192.168.200.196
çµæœï¼šæˆåŠŸ</div>
                        </div>
                        <div class="diagnostic-item fail">
                            <h4>âŒ Mac â†’ è™›æ“¬æ©Ÿ:31000</h4>
                            <div class="code-block">telnet 192.168.200.196 31000
çµæœï¼šOperation timed out</div>
                        </div>
                    </div>
                    
                    <div class="problem-box">
                        <strong>æ ¹æœ¬å•é¡Œï¼š</strong>è™›æ“¬æ©Ÿè»Ÿé«”çš„ç¶²è·¯è¨­å®šé˜»æ“‹äº† 31000 ç«¯å£çš„è¨ªå•
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">6</div>
                <div class="step-content">
                    <h3>ğŸ› ï¸ å˜—è©¦ä¿®å¾©æ–¹æ¡ˆ 1ï¼šiptables ç«¯å£è½‰ç™¼</h3>
                    
                    <div class="code-block">sudo iptables -t nat -A PREROUTING -p tcp --dport 31000 -j DNAT --to-destination 192.168.49.2:31000
sudo iptables -t nat -A POSTROUTING -j MASQUERADE</div>
                    
                    <div class="problem-box">
                        <strong>çµæœï¼š</strong>âŒ å¤±æ•—ï¼ŒMac é‚„æ˜¯ç„¡æ³•è¨ªå•
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number">7</div>
                <div class="step-content">
                    <h3>ğŸ”§ å˜—è©¦ä¿®å¾©æ–¹æ¡ˆ 2ï¼šsocat ç«¯å£è½‰ç™¼</h3>
                    
                    <div class="code-block">sudo socat TCP-LISTEN:31000,bind=0.0.0.0,fork,reuseaddr TCP:192.168.49.2:31000 &</div>
                    
                    <div class="diagnostic-results">
                        <div class="diagnostic-item pass">
                            <h4>âœ… è™›æ“¬æ©Ÿå…§éƒ¨</h4>
                            <div class="code-block">curl http://localhost:31000
çµæœï¼šæˆåŠŸ</div>
                        </div>
                        <div class="diagnostic-item fail">
                            <h4>âŒ Mac å¤–éƒ¨è¨ªå•</h4>
                            <div class="code-block">curl http://192.168.200.196:31000
çµæœï¼šé‚„æ˜¯å¤±æ•—</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number solution">8</div>
                <div class="step-content">
                    <h3>ğŸ’¡ è‡¨æ™‚è§£æ±ºæ–¹æ¡ˆï¼šSSH éš§é“</h3>
                    
                    <div class="code-block">ssh -L 31000:localhost:31000 ericwang0@192.168.200.196</div>
                    
                    <div class="solution-box">
                        <strong>çµæœï¼š</strong>âœ… æˆåŠŸï¼Mac å¯ä»¥é€šé <code>http://localhost:31000</code> è¨ªå•
                    </div>
                    
                    <div class="network-diagram">
                        <div class="network-node working">Mac:31000</div>
                        <div class="arrow success">SSHéš§é“</div>
                        <div class="network-node vm">è™›æ“¬æ©Ÿ:31000</div>
                        <div class="arrow success">socat</div>
                        <div class="network-node working">Minikube:31000</div>
                    </div>
                </div>
            </div>

            <div class="step">
                <div class="step-number solution">9</div>
                <div class="step-content">
                    <h3>ğŸ‰ æœ€çµ‚è§£æ±ºæ–¹æ¡ˆï¼šæ›ç«¯å£æˆåŠŸï¼</h3>
                    
                    <div class="code-block">sudo socat TCP-LISTEN:8090,bind=0.0.0.0,fork,reuseaddr TCP:192.168.49.2:31000 &</div>
                    
                    <div class="final-solution">
                        <h2>ğŸš€ å¤§æˆåŠŸï¼</h2>
                        <p>Mac Safari å¯ä»¥ç›´æ¥è¨ªå•ï¼š<strong>http://192.168.200.196:8090</strong></p>
                        <p>NodePort 31000 çš„åŠŸèƒ½å®Œå…¨å¯¦ç¾ï¼</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="lesson-learned">
            <h2>ğŸ“š å®Œæ•´çš„ç¶²è·¯æµé‡è·¯å¾‘</h2>
            
            <div class="port-flow">
                <div class="port-box working">Mac Safari</div>
                <div class="arrow success">â†’</div>
                <div class="port-box working">192.168.200.196:8090</div>
                <div class="arrow success">socatè½‰ç™¼</div>
                <div class="port-box working">192.168.49.2:31000</div>
                <div class="arrow success">NodePort</div>
                <div class="port-box working">Service:80</div>
                <div class="arrow success">â†’</div>
                <div class="port-box working">Pod:80</div>
            </div>
            
            <div style="background: #fff3cd; padding: 25px; border-radius: 10px; border-left: 5px solid #f39c12; margin: 25px 0;">
                <h3>ğŸ”‘ æˆåŠŸçš„é—œéµï¼šç«¯å£é€£æ¥åŸç†</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: #ffeaa7; padding: 20px; border-radius: 10px; border: 2px solid #e17055;">
                        <h4>âŒ ä¹‹å‰ç‚ºä»€éº¼å¤±æ•—ï¼Ÿ</h4>
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="background: #e74c3c; color: white; padding: 10px; border-radius: 8px; margin: 5px;">Mac</div>
                            <div style="font-size: 1.5em; color: #e74c3c;">âŒ è¢«é˜»æ“‹</div>
                            <div style="background: #e74c3c; color: white; padding: 10px; border-radius: 8px; margin: 5px;">è™›æ“¬æ©Ÿ:31000</div>
                        </div>
                        <p><strong>31000 ç«¯å£è¢«è™›æ“¬æ©Ÿè»Ÿé«”é˜»æ“‹</strong><br>å°±åƒé–€è¢«é–ä½ï¼Œé€²ä¸å»</p>
                    </div>
                    
                    <div style="background: #d1f2eb; padding: 20px; border-radius: 10px; border: 2px solid #00b894;">
                        <h4>âœ… ç¾åœ¨ç‚ºä»€éº¼æˆåŠŸï¼Ÿ</h4>
                        <div style="text-align: center; margin: 15px 0;">
                            <div style="background: #27ae60; color: white; padding: 10px; border-radius: 8px; margin: 5px;">Mac</div>
                            <div style="font-size: 1.5em; color: #27ae60;">âœ… æš¢é€š</div>
                            <div style="background: #27ae60; color: white; padding: 10px; border-radius: 8px; margin: 5px;">è™›æ“¬æ©Ÿ:8090</div>
                            <div style="font-size: 1.2em; color: #f39c12;">socatæ©‹æ¨‘</div>
                            <div style="background: #27ae60; color: white; padding: 10px; border-radius: 8px; margin: 5px;">è™›æ“¬æ©Ÿ:31000</div>
                        </div>
                        <p><strong>8090 ç«¯å£æ²’è¢«é˜»æ“‹ + socat å…§éƒ¨è½‰ç™¼</strong><br>æ›äº†ä¸€æ‰‡é–‹è‘—çš„é–€ï¼Œå…§éƒ¨æœ‰å°å¼•</p>
                    </div>
                </div>
                
                <div style="background: #e8f4fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4>ğŸ  ç”¨æˆ¿å­æ¯”å–»ç†è§£</h4>
                    <div style="display: flex; align-items: center; justify-content: space-around; flex-wrap: wrap; margin: 15px 0;">
                        <div style="text-align: center; margin: 10px;">
                            <div style="background: #3498db; color: white; padding: 15px; border-radius: 10px; margin: 5px;">ğŸš¶â€â™‚ï¸ ä½  (Mac)</div>
                            <small>æƒ³è¦æ‹œè¨ªæœ‹å‹</small>
                        </div>
                        <div style="font-size: 2em; color: #3498db;">â†’</div>
                        <div style="text-align: center; margin: 10px;">
                            <div style="background: #f39c12; color: white; padding: 15px; border-radius: 10px; margin: 5px;">ğŸ¢ å¤§æ¨“ (è™›æ“¬æ©Ÿ)</div>
                            <small>æœ‰å¾ˆå¤šé–€</small>
                        </div>
                        <div style="font-size: 2em; color: #f39c12;">â†’</div>
                        <div style="text-align: center; margin: 10px;">
                            <div style="background: #27ae60; color: white; padding: 15px; border-radius: 10px; margin: 5px;">ğŸ¢ è¾¦å…¬å®¤ (Minikube)</div>
                            <small>æœ‹å‹åœ¨é€™è£¡</small>
                        </div>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <p><strong>ä¹‹å‰ï¼š</strong>ä½ æƒ³é€²ã€Œ31000è™Ÿé–€ã€â†’ é–€è¢«é–ä½ âŒ</p>
                        <p><strong>ç¾åœ¨ï¼š</strong>ä½ é€²ã€Œ8090è™Ÿé–€ã€â†’ é–€è¡›(socat)å¸¶ä½ åˆ°ã€Œ31000è™Ÿè¾¦å…¬å®¤ã€âœ…</p>
                    </div>
                </div>
                
                <div style="background: #2d3748; color: #e2e8f0; padding: 20px; border-radius: 10px; margin: 20px 0;">
                    <h4 style="color: #e2e8f0;">ğŸ’» æœ€çµ‚æˆåŠŸçš„å‘½ä»¤è§£æ</h4>
                    <div style="font-family: 'Courier New', monospace; margin: 15px 0; font-size: 1.1em;">
                        <div style="color: #4fd1c7;">sudo socat</div>
                        <div style="color: #f6ad55; margin-left: 20px;">TCP-LISTEN:8090,bind=0.0.0.0,fork,reuseaddr</div>
                        <div style="color: #68d391; margin-left: 20px;">TCP:192.168.49.2:31000</div>
                        <div style="color: #fbb6ce; margin-left: 20px;">&</div>
                    </div>
                    
                    <div style="margin: 15px 0;">
                        <p><span style="color: #4fd1c7;">socat</span> = ç«¯å£è½‰ç™¼å·¥å…·</p>
                        <p><span style="color: #f6ad55;">TCP-LISTEN:8090</span> = åœ¨è™›æ“¬æ©Ÿé–‹å•Ÿ 8090 ç«¯å£ç›£è½</p>
                        <p><span style="color: #68d391;">TCP:192.168.49.2:31000</span> = è½‰ç™¼åˆ° Minikube çš„ 31000 ç«¯å£</p>
                        <p><span style="color: #fbb6ce;">&</span> = åœ¨èƒŒæ™¯åŸ·è¡Œ</p>
                    </div>
                </div>
                
                <div style="background: #00b894; color: white; padding: 20px; border-radius: 10px; text-align: center; margin: 20px 0;">
                    <h3>ğŸ‰ å°±æ˜¯é€™æ¨£ï¼NodePort 31000 ä¸€ç›´éƒ½æ­£å¸¸</h3>
                    <p><strong>å•é¡Œä¸åœ¨ Kubernetesï¼Œè€Œæ˜¯ç¶²è·¯è¨ªå•è·¯å¾‘</strong></p>
                    <p>socat å¹«æˆ‘å€‘å»ºç«‹äº†ä¸€æ¢æ–°çš„ã€Œé«˜é€Ÿå…¬è·¯ã€ï¼</p>
                </div>
            </div>
            
            <h3>ğŸ¯ é—œéµç™¼ç¾èˆ‡å­¸ç¿’</h3>
            <ul>
                <li><strong>NodePort 31000 ä¸€ç›´éƒ½æ­£å¸¸å·¥ä½œ</strong> - å•é¡Œä¸åœ¨ Kubernetes</li>
                <li><strong>è™›æ“¬æ©Ÿè»Ÿé«”æœ‰ç«¯å£é™åˆ¶</strong> - æŸäº›ç«¯å£è¢«é˜»æ“‹ï¼ŒæŸäº›ç«¯å£å…è¨±</li>
                <li><strong>socat æ˜¯è¬èƒ½çš„ç«¯å£è½‰ç™¼å·¥å…·</strong> - æ¯” iptables æ›´å¯é </li>
                <li><strong>åˆ†å±¤è¨ºæ–·å¾ˆé‡è¦</strong> - å¾å…§åˆ°å¤–é€å±¤æ¸¬è©¦</li>
                <li><strong>æ›ç«¯å£æ˜¯æœ‰æ•ˆçš„è®Šé€šæ–¹æ¡ˆ</strong> - 31000 è¢«é˜»æ“‹ï¼Œ8090 å¯ä»¥é€šé</li>
            </ul>
            
            <h3>ğŸ’¡ ç‚ºä»€éº¼æœ€çµ‚æ–¹æ¡ˆæˆåŠŸï¼Ÿ</h3>
            <div class="solution-box">
                <p><strong>8090 ç«¯å£æ²’æœ‰è¢«è™›æ“¬æ©Ÿè»Ÿé«”çš„ç¶²è·¯ç­–ç•¥é˜»æ“‹</strong></p>
                <p>ä¸åŒçš„ç«¯å£å¯èƒ½æœ‰ä¸åŒçš„ç¶²è·¯è¦å‰‡ï¼Œ31000 å¯èƒ½åœ¨æŸå€‹é»‘åå–®ä¸­ï¼Œä½† 8090 æ˜¯ã€Œå®‰å…¨ã€çš„ç«¯å£</p>
            </div>
            
            <h3>ğŸš€ ç”Ÿç”¢ç’°å¢ƒå»ºè­°</h3>
            <ul>
                <li>ä½¿ç”¨ <strong>LoadBalancer</strong> é¡å‹çš„ Serviceï¼ˆé›²ç«¯ç’°å¢ƒï¼‰</li>
                <li>é…ç½® <strong>Ingress Controller</strong> çµ±ä¸€ç®¡ç†å¤–éƒ¨è¨ªå•</li>
                <li>åœ¨è™›æ“¬æ©Ÿè»Ÿé«”ä¸­æ­£ç¢ºè¨­å®š <strong>ç«¯å£è½‰ç™¼è¦å‰‡</strong></li>
                <li>ä½¿ç”¨ <strong>æ©‹æ¥ç¶²è·¯æ¨¡å¼</strong> é¿å… NAT é™åˆ¶</li>
            </ul>
        </div>
    </div>
</body>
</html>
